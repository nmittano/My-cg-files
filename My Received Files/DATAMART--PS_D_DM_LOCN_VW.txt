SELECT L.LOCATION , L.EFFDT , LNG.LANGUAGE_CD 
,NVL((  SELECT DESCR 
  	FROM PS_LOCATION_LANG L_LN 
 	WHERE L.SETID = L_LN.SETID 
   		AND L.LOCATION = L_LN.LOCATION 
   		AND L_LN.EFFDT = L.EFFDT 
   		AND LNG.LANGUAGE_CD = L_LN.LANGUAGE_CD), L.DESCR) AS LOCATION_DESCR, L.BUILDING , L.COUNTRY , L.ADDRESS3 , L.NUM1 , L.POSTAL , L.CITY , L.ESTABID , DL.D_LAMBERT_X , DL.D_LAMBERT_Y , TN.PARENT_NODE_NAME 
, NVL((  SELECT DESCR 
  	 FROM PS_LOCATION_LANG LT_LN 
 	 WHERE LT.SETID = LT_LN.SETID 
   		AND LT.LOCATION = LT_LN.LOCATION 
   		AND LT.EFFDT = LT_LN.EFFDT 
   		AND LNG.LANGUAGE_CD = LT_LN.LANGUAGE_CD), LT.DESCR) AS PARENT_LOCATION_DESCR ,L.EFF_STATUS 
FROM PS_LOCATION_TBL L LEFT OUTER JOIN PSTREENODE TN ON L.SETID = TN.SETID 
   AND TN.TREE_NAME = 'LOCATION' 
   AND L.EFFDT = (  SELECT MAX(TN_ED.EFFDT) 
  			FROM PSTREENODE TN_ED 
 			WHERE TN_ED.SETID = TN.SETID 
   				AND TN_ED.SETCNTRLVALUE = TN.SETCNTRLVALUE 
   				AND TN_ED.TREE_NAME = TN.TREE_NAME 
   				AND TN_ED.EFFDT <= %CurrentDateIn) 
   AND L.LOCATION = TN.TREE_NODE 
   AND L.EFFDT = (  SELECT MAX(L_ED.EFFDT) 
  			FROM PS_LOCATION_TBL L_ED 
 			WHERE L.SETID = L_ED.SETID 
   				AND L.LOCATION = L_ED.LOCATION 
   				AND L_ED.EFFDT <= %CurrentDateIn) , PS_D_LOCATION_TBL DL, PSLANGUAGES LNG , PS_LOCATION_TBL LT 
WHERE DL.LOCATION = L.LOCATION 
   	AND DL.EFFDT = (  SELECT MAX(DL_ED.EFFDT) 
  				FROM PS_D_LOCATION_TBL DL_ED 
 				WHERE DL.COUNTRY = DL_ED.COUNTRY 
   					AND DL_ED.EFFDT <= %CurrentDateIn) 
   	AND LT.SETID = TN.SETID 
   	AND LT.LOCATION = TN.PARENT_NODE_NAME 
   	AND LT.EFFDT = (  SELECT MAX(L_ED.EFFDT) 
  				FROM PS_LOCATION_TBL L_ED 
 				WHERE LT.SETID = L_ED.SETID 
  					AND LT.LOCATION = L_ED.LOCATION 
   					AND L_ED.EFFDT <= %CurrentDateIn) 
   	AND L.EFF_STATUS='A' 
   	AND LNG.LANGUAGE_CD IN ('DUT', 'FRA')